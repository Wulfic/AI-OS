# Persistent Traces & Crystallization: Architecture Diagrams

**Visual Reference for Implementation**  
**Created**: December 8, 2025

---

## ğŸ“ System Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         HRM-ACTV1 Enhanced Model                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Input Tokens                                                           â”‚
â”‚      â”‚                                                                  â”‚
â”‚      â–¼                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚  â”‚ Embeddings  â”‚                                                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                       â”‚
â”‚         â”‚                                                               â”‚
â”‚         â–¼                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚                    Layer 1                              â”‚          â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚          â”‚
â”‚  â”‚  â”‚   Attention  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ TraceManager    â”‚    â”‚          â”‚
â”‚  â”‚  â”‚   + RoPE     â”‚  bias inject â”‚ - Sparse Memory â”‚    â”‚          â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ - Salience      â”‚    â”‚          â”‚
â”‚  â”‚         â”‚                       â”‚ - Decay/Update  â”‚    â”‚          â”‚
â”‚  â”‚         â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚          â”‚
â”‚  â”‚         â”‚                                â”‚             â”‚          â”‚
â”‚  â”‚         â–¼                                â”‚ capture     â”‚          â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚             â”‚          â”‚
â”‚  â”‚  â”‚  MoE Router  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚             â”‚          â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      log paths        â”‚             â”‚          â”‚
â”‚  â”‚         â”‚                                â”‚             â”‚          â”‚
â”‚  â”‚         â–¼                                â”‚             â”‚          â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚          â”‚
â”‚  â”‚  â”‚   Experts    â”‚              â”‚ RoutingPathTree â”‚    â”‚          â”‚
â”‚  â”‚  â”‚  [E1..E8]    â”‚              â”‚ - Suffix Tree   â”‚    â”‚          â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ - Motif Detect  â”‚    â”‚          â”‚
â”‚  â”‚         â”‚                       â”‚ - Crystallize   â”‚    â”‚          â”‚
â”‚  â”‚         â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚            â”‚                                                           â”‚
â”‚           ... (Layers 2-31)                                           â”‚
â”‚            â”‚                                                           â”‚
â”‚            â–¼                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                      â”‚
â”‚  â”‚ Output Head â”‚                                                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                      â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Data Flow: Attention Trace Lifecycle

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Forward Pass (with tracing)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Compute QKV    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Load trace bias â”‚â—„â”€â”€â”€â”€ M^(l,h) (sparse)
                    â”‚ from memory     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  QK^T / âˆšd_k    â”‚
                    â”‚  + Î±Â·M          â”‚  â† Biased attention
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Softmax       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  AttentionÂ·V    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  [DETACH]       â”‚
                    â”‚  Store attn     â”‚  â†’ Temporary buffer
                    â”‚  weights        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Backward Pass (gradient capture)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ loss.backward() â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Extract âˆ‚L/âˆ‚A  â”‚  â† Attention gradients
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Compute salienceâ”‚
                    â”‚ S = AÂ·|âˆ‚L/âˆ‚A|   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Top-k selection â”‚  â† Only high salience
                    â”‚ (k â‰ˆ 0.1% edges)â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Update M^(l,h)  â”‚
                    â”‚ with EMA/decay  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸŒ³ Routing Path Tree Structure

```
                              Root
                               â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚              â”‚              â”‚
               Eâ‚             Eâ‚‚             Eâ‚ƒ  â† Layer 1
          count: 523      count: 892     count: 341
         reward: 412     reward: 705    reward: 268
                â”‚              â”‚              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”´â”€â”€â”€â”
        â”‚       â”‚     â”‚   â”‚    â”‚    â”‚    â”‚       â”‚
       Eâ‚      Eâ‚‚    Eâ‚ƒ  Eâ‚   Eâ‚‚   Eâ‚ƒ   Eâ‚      Eâ‚‚  â† Layer 2
    cnt:201 cnt:198     ...
                â”‚
            â”Œâ”€â”€â”€â”¼â”€â”€â”€â”
            â”‚   â”‚   â”‚
           Eâ‚  Eâ‚‚  Eâ‚ƒ  â† Layer 3
              ...

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

High-Utility Path Example:

Ï€ = [Eâ‚‚ â†’ Eâ‚ â†’ Eâ‚ƒ â†’ Eâ‚‚]
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    Frequency: 198 (> threshold)
    Utility: +0.07 (> threshold)
    Entropy: 0.8 (< threshold)
    â†’ CRYSTALLIZE âœ“

Creates new expert: E_motif42

Future routing can select E_motif42 directly,
bypassing individual expert routing.
```

---

## ğŸ’¾ Memory Layout: Trace Storage

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               TraceMemory (Per Layer/Head)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Sparse COO Format:                                     â”‚
â”‚                                                         â”‚
â”‚  traces: List[AttentionTrace]                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ AttentionTrace #1:                                â”‚ â”‚
â”‚  â”‚   layer_id:     5    (1 byte)                     â”‚ â”‚
â”‚  â”‚   head_id:      12   (1 byte)                     â”‚ â”‚
â”‚  â”‚   query_idx:    1024 (2 bytes)                    â”‚ â”‚
â”‚  â”‚   key_idx:      512  (2 bytes)                    â”‚ â”‚
â”‚  â”‚   salience:     0.85 (4 bytes float32)            â”‚ â”‚
â”‚  â”‚   age:          3    (2 bytes)                    â”‚ â”‚
â”‚  â”‚                              Total: 12 bytes       â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ AttentionTrace #2:                                â”‚ â”‚
â”‚  â”‚   ...                                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                         â”‚
â”‚  max_traces: 2048 per head                             â”‚
â”‚  Total: 2048 Ã— 12 bytes = 24 KB per head              â”‚
â”‚                                                         â”‚
â”‚  For 32 layers Ã— 32 heads:                             â”‚
â”‚  Total: 32 Ã— 32 Ã— 24 KB = 24.6 MB                     â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Fast Lookup via Hash Map                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  trace_index: HashMap[(layer, head, i, j) â†’ salience] â”‚
â”‚                                                         â”‚
â”‚  Example:                                               â”‚
â”‚  (5, 12, 1024, 512) â†’ 0.85                             â”‚
â”‚  (5, 12, 2048, 256) â†’ 0.72                             â”‚
â”‚  ...                                                    â”‚
â”‚                                                         â”‚
â”‚  O(1) lookup for bias injection                        â”‚
â”‚  O(log n) insert for updates (maintain sorted)         â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”€ Training Loop Integration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Standard Training Loop                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  for batch in dataloader:                                     â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚      â”‚  1. Forward Pass                            â”‚         â”‚
â”‚      â”‚     - Attention with trace bias             â”‚         â”‚
â”‚      â”‚     - MoE routing logged                    â”‚         â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                â”‚                                               â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚      â”‚  2. Compute Loss                            â”‚         â”‚
â”‚      â”‚     L_total = L_task + Î²â‚Â·L_balance         â”‚         â”‚
â”‚      â”‚             + Î²â‚‚Â·L_trace + Î²â‚ƒÂ·L_crystal     â”‚         â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                â”‚                                               â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚      â”‚  3. Backward Pass                           â”‚         â”‚
â”‚      â”‚     - Compute gradients                     â”‚         â”‚
â”‚      â”‚     - Extract âˆ‚L/âˆ‚A for salience            â”‚         â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                â”‚                                               â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚      â”‚  4. Optimizer Step                          â”‚         â”‚
â”‚      â”‚     - Update model weights                  â”‚         â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                â”‚                                               â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚      â”‚  5. Periodic Trace Update                   â”‚         â”‚
â”‚      â”‚     if step % UPDATE_INTERVAL == 0:         â”‚         â”‚
â”‚      â”‚       - Compute salience scores             â”‚         â”‚
â”‚      â”‚       - Update trace memory (EMA)           â”‚         â”‚
â”‚      â”‚       - Apply decay to unused traces        â”‚         â”‚
â”‚      â”‚       - Evict lowest salience if quota full â”‚         â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                â”‚                                               â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚      â”‚  6. Periodic Motif Update                   â”‚         â”‚
â”‚      â”‚     if step % CRYSTALLIZE_INTERVAL == 0:    â”‚         â”‚
â”‚      â”‚       - Traverse routing tree               â”‚         â”‚
â”‚      â”‚       - Compute utilities                   â”‚         â”‚
â”‚      â”‚       - Detect crystallization candidates   â”‚         â”‚
â”‚      â”‚       - Freeze high-utility motifs          â”‚         â”‚
â”‚      â”‚       - Prune low-utility motifs            â”‚         â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Salience Computation Pipeline

```
  Attention Weights (A)         Gradients (âˆ‚L/âˆ‚A)      Recurrence (p)
        â”‚                              â”‚                      â”‚
        â”‚ [B, H, T, T]                â”‚ [B, H, T, T]        â”‚ [T, T]
        â”‚                              â”‚                      â”‚
        â–¼                              â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   A_{i,j}     â”‚            â”‚   |âˆ‚L/âˆ‚A|      â”‚     â”‚ log(1 + p)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
        â”‚                             â”‚                     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
                      â”‚                                     â”‚
                      â–¼                                     â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
              â”‚   A Â· |âˆ‚L/âˆ‚A|â”‚                             â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                             â”‚
                      â”‚                                     â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚  Salience Score â”‚
                          â”‚  S = AÂ·|âˆ‚|Â·log p â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚  Threshold      â”‚
                          â”‚  S > Î¸?         â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                             â”‚
                   YES                           NO
                    â”‚                             â”‚
                    â–¼                             â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  Add to traces   â”‚         â”‚  Apply decay     â”‚
          â”‚  (EMA update)    â”‚         â”‚  M â† Î³Â·M         â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Crystallization Decision Tree

```
                    Routing Path Ï€
                         â”‚
                         â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Frequency f(Ï€)   â”‚
                â”‚ > f_min?         â”‚
                â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                    YES      NO
                     â”‚        â”‚
                     â”‚        â””â”€â”€â–º Reject (insufficient data)
                     â”‚
                     â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Utility U(Ï€)     â”‚
                â”‚ > U_min?         â”‚
                â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                    YES      NO
                     â”‚        â”‚
                     â”‚        â””â”€â”€â–º Reject (not beneficial)
                     â”‚
                     â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Entropy H(Ï€)     â”‚
                â”‚ < H_max?         â”‚
                â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                    YES      NO
                     â”‚        â”‚
                     â”‚        â””â”€â”€â–º Reject (unstable routing)
                     â”‚
                     â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Age age(Ï€)       â”‚
                â”‚ > Ï„?             â”‚
                â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                    YES      NO
                     â”‚        â”‚
                     â”‚        â””â”€â”€â–º Reject (temporal instability)
                     â”‚
                     â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Motif quota      â”‚
                â”‚ available?       â”‚
                â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                    YES      NO
                     â”‚        â”‚
                     â”‚        â””â”€â”€â–º Evict lowest-utility motif
                     â”‚             (if U(Ï€) > U_min(existing))
                     â”‚
                     â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  CRYSTALLIZE MOTIF  â”‚
            â”‚  - Create new expertâ”‚
            â”‚  - Freeze pathway   â”‚
            â”‚  - Register in MoE  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”¬ Experimental Monitoring Dashboard

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Training Metrics                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  Loss Components:                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ L_task:        2.34 â†“ (main task loss)                   â”‚ â”‚
â”‚  â”‚ L_balance:     0.05 ~ (MoE load balance)                 â”‚ â”‚
â”‚  â”‚ L_trace:       0.12 â†“ (trace utilization)                â”‚ â”‚
â”‚  â”‚ L_crystal:     0.08 â†“ (crystallization entropy)          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”‚  Trace Statistics:                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Total traces:      1.2M / 2.1M (57% capacity)            â”‚ â”‚
â”‚  â”‚ Avg salience:      0.42 (healthy)                        â”‚ â”‚
â”‚  â”‚ Coverage:          34% (attention ops using traces)      â”‚ â”‚
â”‚  â”‚ Decay rate:        0.98 (auto-tuned)                     â”‚ â”‚
â”‚  â”‚ Memory usage:      18.3 MB / 24.6 MB                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”‚  Crystallization Statistics:                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Active motifs:     87 / 512 (17% capacity)               â”‚ â”‚
â”‚  â”‚ Avg utility:       +0.09 (9% improvement)                â”‚ â”‚
â”‚  â”‚ Avg entropy:       0.7 (stable)                          â”‚ â”‚
â”‚  â”‚ FLOP reduction:    23% (via motif reuse)                 â”‚ â”‚
â”‚  â”‚ Tree nodes:        12.4K (manageable)                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”‚  Emergent Language Properties:                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Max hierarchy:     3 levels deep                         â”‚ â”‚
â”‚  â”‚ Composition rate:  42% (motifs calling motifs)           â”‚ â”‚
â”‚  â”‚ Task clustering:   Silhouette = 0.61 (good)              â”‚ â”‚
â”‚  â”‚ Symbol efficiency: 8.2Ã— compression vs tokens            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ› ï¸ File Structure

```
src/aios/core/hrm_models/cognitive/
â”‚
â”œâ”€â”€ __init__.py                    # Module exports
â”‚
â”œâ”€â”€ trace_manager.py               # Persistent attention traces
â”‚   â”œâ”€â”€ class TraceManager
â”‚   â”‚   â”œâ”€â”€ __init__(config)
â”‚   â”‚   â”œâ”€â”€ capture_attention(layer, head, attn_weights)
â”‚   â”‚   â”œâ”€â”€ compute_salience(attn, grads, recurrence)
â”‚   â”‚   â”œâ”€â”€ update_traces(salience_scores)
â”‚   â”‚   â”œâ”€â”€ apply_decay()
â”‚   â”‚   â”œâ”€â”€ get_bias_for_layer_head(layer, head)
â”‚   â”‚   â””â”€â”€ to_sparse_tensor()
â”‚   â”‚
â”‚   â””â”€â”€ class AttentionTrace (dataclass)
â”‚       â”œâ”€â”€ layer_id: uint8
â”‚       â”œâ”€â”€ head_id: uint8
â”‚       â”œâ”€â”€ query_idx: uint16
â”‚       â”œâ”€â”€ key_idx: uint16
â”‚       â”œâ”€â”€ salience: float32
â”‚       â””â”€â”€ age: uint16
â”‚
â”œâ”€â”€ routing_tree.py                # MoE path tracking
â”‚   â”œâ”€â”€ class RoutingNode
â”‚   â”‚   â”œâ”€â”€ expert_id: int
â”‚   â”‚   â”œâ”€â”€ layer: int
â”‚   â”‚   â”œâ”€â”€ count: int
â”‚   â”‚   â”œâ”€â”€ total_reward: float
â”‚   â”‚   â”œâ”€â”€ children: Dict[int, RoutingNode]
â”‚   â”‚   â”œâ”€â”€ utility() â†’ float
â”‚   â”‚   â””â”€â”€ entropy() â†’ float
â”‚   â”‚
â”‚   â””â”€â”€ class RoutingPathTree
â”‚       â”œâ”€â”€ root: RoutingNode
â”‚       â”œâ”€â”€ motif_registry: Dict[str, CrystallizedMotif]
â”‚       â”œâ”€â”€ record_path(path, reward)
â”‚       â”œâ”€â”€ find_candidates()
â”‚       â””â”€â”€ prune_low_utility()
â”‚
â”œâ”€â”€ crystallization.py             # Motif freezing logic
â”‚   â”œâ”€â”€ class CrystallizedMotif
â”‚   â”‚   â”œâ”€â”€ path: List[int]
â”‚   â”‚   â”œâ”€â”€ frozen_experts: nn.Module
â”‚   â”‚   â”œâ”€â”€ utility: float
â”‚   â”‚   â”œâ”€â”€ frequency: int
â”‚   â”‚   â””â”€â”€ forward(x)
â”‚   â”‚
â”‚   â””â”€â”€ class CrystallizationManager
â”‚       â”œâ”€â”€ detect_motifs(tree)
â”‚       â”œâ”€â”€ freeze_motif(path)
â”‚       â”œâ”€â”€ unfreeze_motif(motif_id)
â”‚       â””â”€â”€ evaluate_utility(motif)
â”‚
â”œâ”€â”€ losses.py                      # Auxiliary loss functions
â”‚   â”œâ”€â”€ trace_utilization_loss(trace_manager)
â”‚   â”œâ”€â”€ crystallization_entropy_loss(routing_tree)
â”‚   â””â”€â”€ elastic_weight_consolidation(model, fisher_info)
â”‚
â”œâ”€â”€ config.py                      # Configuration schemas
â”‚   â”œâ”€â”€ class TraceConfig (TypedDict)
â”‚   â””â”€â”€ class CrystallizationConfig (TypedDict)
â”‚
â””â”€â”€ visualization.py               # Analysis tools
    â”œâ”€â”€ plot_trace_heatmap()
    â”œâ”€â”€ plot_routing_sankey()
    â”œâ”€â”€ plot_motif_hierarchy()
    â””â”€â”€ export_motif_graph()
```

---

## ğŸ¨ Color Coding for Visualizations

**Trace Salience**:
- ğŸŸ¦ Low salience (0.0-0.3): Recently captured, not yet consolidated
- ğŸŸ© Medium salience (0.3-0.7): Moderately reinforced
- ğŸŸ¨ High salience (0.7-0.9): Strongly reinforced
- ğŸŸ¥ Critical salience (0.9-1.0): Core reasoning pathways

**Motif Utility**:
- â¬œ Neutral (U â‰ˆ 0): No benefit
- ğŸŸ¦ Low benefit (U = 0.01-0.05): Minor improvement
- ğŸŸ© Moderate benefit (U = 0.05-0.10): Worth crystallizing
- ğŸŸ¨ High benefit (U = 0.10-0.20): Very valuable
- ğŸŸ¥ Critical (U > 0.20): Essential pattern

**Routing Entropy**:
- ğŸŸ© Low entropy (H < 0.5): Deterministic, stable
- ğŸŸ¨ Medium entropy (H = 0.5-1.0): Somewhat stable
- ğŸŸ¥ High entropy (H > 1.0): Unstable, don't crystallize

---

**Status**: Visual reference complete  
**Usage**: Print this for implementation reference  
**Next**: Begin coding Phase 0 infrastructure
